var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var S=(r,e,n)=>e in r?J(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,q=(r,e)=>{for(var n in e||(e={}))L.call(e,n)&&S(r,n,e[n]);if(x)for(var n of x(e))M.call(e,n)&&S(r,n,e[n]);return r},E=(r,e)=>X(r,Y(e));var O=(r,e)=>{var n={};for(var a in r)L.call(r,a)&&e.indexOf(a)<0&&(n[a]=r[a]);if(r!=null&&x)for(var a of x(r))e.indexOf(a)<0&&M.call(r,a)&&(n[a]=r[a]);return n};var u=(r,e,n)=>(S(r,typeof e!="symbol"?e+"":e,n),n);import{m as Z,j as A,F as $,f as ee,a as te,b as re,c as ne,d as se,o as F,r as p,g as K,u as ae,e as le,h as oe,A as ce,I as ie,i as ue,R as de,k as he}from"./vendor.e9e32ebb.js";const pe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}};pe();const me="_player_vse6p_1",_e="_musicImage_vse6p_59";var U={player:me,musicImage:_e};class fe{constructor(){u(this,"tracks",[]);u(this,"currentTrack",null);u(this,"playing",!1);u(this,"isLoading",!0);u(this,"volume",1);u(this,"currentTime",0);u(this,"duration",0);u(this,"url","https://eyes-closed-server.herokuapp.com/graphql");Z(this,{},{autoBind:!0})}setDuration(e){this.duration=e}setCurrentTime(e){this.currentTime=e}setVolume(e){this.volume=e}setLoading(e){this.isLoading=e}setTracks(e){this.tracks=e}setPlaying(e){this.playing=e}setCurrentTrack(e,n=!0){this.currentTrack=e,this.setPlaying(n)}addToTracks(e){this.tracks.push(e)}prevTrack(){const e=this.tracks.indexOf(this.currentTrack);e===0?this.setCurrentTrack(this.tracks[this.tracks.length-1]):this.setCurrentTrack(this.tracks[e-1])}nextTrack(){const e=this.tracks.indexOf(this.currentTrack);e===this.tracks.length-1?this.setCurrentTrack(this.tracks[0]):this.setCurrentTrack(this.tracks[e+1])}handleEnd(){this.nextTrack()}}var C=new fe;const ge="_wrapper_rh7xg_1",ke="_rewindControls_rh7xg_19",ve="_musicImage_rh7xg_29";var P={wrapper:ge,rewindControls:ke,musicImage:ve};const ye="_box_dmcht_1";var xe={box:ye};const t=A.exports.jsx,o=A.exports.jsxs,W=A.exports.Fragment,G=()=>t("div",{className:xe.box,children:t($,{style:{fontSize:"1.7rem"},icon:ee,color:"black"})}),Te=({toggleAudio:r,nextTrack:e,prevTrack:n,playing:a})=>o("div",{className:P.wrapper,children:[t("div",{className:P.musicImage,children:t(G,{})}),t($,{className:"clickable",onClick:r,style:{fontSize:"2.5rem"},icon:a?te:re,color:"black"}),o("div",{className:P.rewindControls,children:[t($,{className:"clickable",style:{fontSize:"1.5rem"},icon:ne,color:"black",onClick:n}),t($,{className:"clickable",style:{fontSize:"1.5rem"},icon:se,color:"black",onClick:e})]})]}),be="_infoInnerBox_e4w1s_1",Ne="_title_e4w1s_13",$e="_progressBar_e4w1s_29",Ce="_info_e4w1s_1";var _={infoInnerBox:be,title:Ne,progressBar:$e,info:Ce};const D=r=>{const e=Math.floor(r/60),n=Math.floor(r%60),a=e<10?`0${e}`:`${e}`,s=n<10?`0${n}`:`${n}`;return`${a}:${s}`},we=({track:r,duration:e,currentTime:n,handleProgress:a,canChangeTime:s})=>o("div",{className:_.info,children:[o("div",{className:_.infoInnerBox,children:[t("h2",{className:_.title,children:r==null?void 0:r.title}),t("p",{children:D(e)})]}),o("div",{className:_.infoInnerBox,children:[t("h3",{className:_.title,children:r==null?void 0:r.author}),t("p",{children:D(n)})]}),t("input",{className:_.progressBar,type:"range",disabled:!s,onChange:a,value:e?Math.round(n*100/e):0})]}),Be="_box_rwxli_1",Ie="_title_rwxli_17";var R={box:Be,title:Ie};const Se=({volumeState:r,handleVolume:e})=>o("div",{className:R.box,children:[o("p",{className:R.title,children:["Volume: ",Math.round(r*100),"%"]}),t("input",{className:"clickable",type:"range",value:Math.round(r*100),onChange:n=>e(n)})]});let c=new Audio,T=!0;const Pe=F(()=>{const{currentTime:r,duration:e,volume:n,playing:a,currentTrack:s,nextTrack:l,prevTrack:i,setCurrentTime:f,setDuration:w,setVolume:B,setPlaying:y,handleEnd:I}=C;p.exports.useEffect(()=>{s&&(c.src=s.src,c.ontimeupdate=()=>f(c.currentTime),c.onloadeddata=()=>{setTimeout(()=>{T=!0},200),w(c.duration)},c.onended=()=>{T=!1,console.log("end"),I()},m())},[s]);const m=async()=>{if(c.paused){y(!0);try{await c.play()}catch(g){console.log(g)}}else y(!1),c.pause()},h=g=>{if(T){const k=g.target.value*e/100;c.currentTime=k,f(k)}},Q=g=>{const k=g.target.value/100;B(k),c.volume=k};return s?o("div",{className:U.player,children:[t(Te,{toggleAudio:m,nextTrack:l,prevTrack:i,playing:a}),t("div",{className:U.musicImage,children:t(G,{})}),t(we,{track:s,duration:e,currentTime:r,handleProgress:h,canChangeTime:T}),t(Se,{volumeState:n,handleVolume:Q})]}):null}),Ae="_loadingWrapper_flrcn_1",Fe="_loading_flrcn_1",Le="_load_flrcn_1";var j={loadingWrapper:Ae,loading:Fe,load:Le};const H=()=>t("div",{className:j.loadingWrapper,children:t("div",{className:j.loading})}),Me="_track_139nv_1",qe="_info_139nv_39",Ee="_innerBox_139nv_59",Oe="_text_139nv_67",Ue="_active_139nv_87",De="_trackBox_139nv_105";var d={track:Me,info:qe,innerBox:Ee,text:Oe,active:Ue,trackBox:De};const Re=F(({track:r,index:e})=>{const{tracks:n,setCurrentTrack:a,currentTrack:s}=C;let l=!1;return s&&(l=n[e].id===s.id),o("button",{className:l?`${d.track} ${d.active}`:d.track,onClick:()=>!l&&a(r),children:[t("div",{className:d.trackBox}),o("div",{className:d.info,children:[t("div",{className:d.innerBox,children:t("h2",{className:d.text,children:r.title})}),t("div",{className:d.innerBox,children:t("h3",{className:d.text,children:r.author})})]})]})}),je="_playlist_nuh74_1",Ve="_title_nuh74_23",ze="_buttonFlex_nuh74_33",Ke="_btn_nuh74_45",We="_tracksBlock_nuh74_75";var v={playlist:je,title:Ve,buttonFlex:ze,btn:Ke,tracksBlock:We};const Ge="_wrapper_1fdel_1",He="_active_1fdel_25",Qe="_inner_1fdel_37";var b={wrapper:Ge,active:He,inner:Qe};const Je="_title_ft8fd_1",Xe="_btn_ft8fd_9",Ye="_uploadTitle_ft8fd_45",Ze="_loadingTitle_ft8fd_57";var N={title:Je,btn:Xe,uploadTitle:Ye,loadingTitle:Ze};const et=K`
  mutation addTrack($title: String!, $author: String!, $file: Upload!) {
    addTrack(title: $title, author: $author, file: $file) {
      src
      author
      title
      id
    }
  }
`,tt="_input_aq37v_1";var rt={input:tt};const V=p.exports.memo(function({inputState:r,setInputState:e,label:n,id:a}){return o(W,{children:[t("label",{htmlFor:a,children:t("h3",{children:n})}),t("input",{id:a,required:!0,className:rt.input,value:r,onChange:s=>e(s.target.value),type:"text"})]})}),nt=function({setModal:r}){const{addToTracks:e}=C,[n,a]=p.exports.useState(null),[s,l]=p.exports.useState(""),[i,f]=p.exports.useState(""),[w,{loading:B}]=ae(et),y=async m=>{const h=await m.target.files[0];h.type.includes("audio/")?a(h):alert("\u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 audio/mpeg \u0444\u0430\u0439\u043B")},I=async m=>{m.preventDefault();try{const{data:{addTrack:h}}=await w({variables:{title:s,author:i,file:n}});e(h),r(!1),f(""),l("")}catch(h){alert("Failed to upload track to server"),console.log("upload failed: ",h)}};return B?o(W,{children:[t("p",{className:N.loadingTitle,children:"Uploading track. Please wait."}),t(H,{})]}):o("form",{action:"",onSubmit:I,children:[t("h1",{className:N.title,children:"Upload Track"}),t(V,{inputState:i,setInputState:f,id:"author",label:"Author"}),t(V,{inputState:s,setInputState:l,id:"title",label:"Title"}),t("label",{htmlFor:"file",children:t("h1",{className:N.uploadTitle,children:"Upload audio File"})}),t("input",{required:!0,id:"file",type:"file",accept:"audio/*",onChange:y}),t("button",{className:N.btn,type:"submit",children:"UPLOAD TRACK"})]})},st=p.exports.memo(function({modal:r,setModal:e}){return t("div",{onClick:()=>e(!r),className:r?`${b.wrapper} ${b.active}`:b.wrapper,children:t("div",{onClick:n=>n.stopPropagation(),className:b.inner,children:t(nt,{setModal:e})})})}),at="_title_xynlk_1";var lt={title:at};const ot=()=>t("div",{children:t("p",{className:lt.title,children:"Connection Error"})}),ct=K`
  query GetAllTracks {
    getAllTracks {
      id
      title
      author
      src
    }
  }
`,it=()=>{const{tracks:r,setTracks:e}=C,[n,a]=p.exports.useState(!0),{error:s}=le(ct,{onCompleted:({getAllTracks:l})=>{e(l),a(!1)},onError:()=>{a(!1)}});return{tracks:r,loading:n,error:s}},ut="_block_11qbe_1";var dt={block:ut};const z=n=>{var a=n,{children:r}=a,e=O(a,["children"]);return t("div",E(q({className:dt.block},e),{children:r}))},ht=F(()=>{const{tracks:r,loading:e,error:n}=it(),[a,s]=p.exports.useState(!1);return n?t(z,{children:t(ot,{})}):e?t(z,{children:t(H,{})}):o("section",{className:v.playlist,children:[o("div",{className:v.buttonFlex,children:[t("h1",{className:v.title,children:`Playlist: ${r.length}`}),t("button",{onClick:()=>s(!a),className:v.btn,children:"Add new track"})]}),t("ul",{className:v.tracksBlock,children:r.map((l,i)=>t("li",{children:t(Re,{track:l,index:i})},l.id))}),t(st,{modal:a,setModal:s})]})}),pt="https://eyes-closed-server.herokuapp.com/graphql",mt=oe({uri:pt}),_t=new ce({link:mt,cache:new ie}),ft=()=>t(ue,{client:_t,children:o("div",{className:"container",children:[t(Pe,{}),t(ht,{})]})});de.render(t(he.StrictMode,{children:t(ft,{})}),document.getElementById("root"));
